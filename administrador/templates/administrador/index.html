{% extends "administrador/base.html" %}
{% load static %}
{% block title %}Administrador - Dashboard{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/style.css' %}">

<div class="dashboard">
  <!-- Encabezado -->
  <header class="admin-header">
    <div>
      <h2>Panel de control</h2>
      <p class="subtitle">Resumen general del punto de venta</p>
    </div>
  </header>

  <!-- Cards resumen -->
  <section class="cards">
    <a class="card card-link-block" href="{% url 'administrador:dashboard_productos' %}">
      <div class="card-icon">ðŸ“¦</div>
      <h3>Registrar Productos</h3>
      <p class="large">{{ productos_count|default:"0" }}</p>
    </a>

    <a class="card card-link-block" href="{% url 'administrador:ventas_historial' %}">
      <div class="card-icon">ðŸ’°</div>
      <h3>Ventas totales</h3>
      <p class="large">
        {% if ventas_total %}
          {{ ventas_total }}
        {% else %}
          0
        {% endif %}
      </p>
    </a>

    <a class="card card-link-block" href="{% url 'administrador:reportes' %}">
      <div class="card-icon">ðŸ“Š</div>
      <h3>Reportes</h3>
      <p class="large">Ver reportes</p>
    </a>
  </section>

  <!-- Contenido en dos columnas -->
  <div class="dashboard-grid">

    <!-- Ventas recientes -->
    <section class="block">
      <div class="block-header">
        <h3>Ventas recientes</h3>
        <p class="block-subtitle">Ãšltimas ventas registradas en el sistema.</p>
      </div>

      {% if ventas_recientes %}
      <table class="table">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Vendedor</th>
            <th>Productos</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          {% for v in ventas_recientes %}
          <tr>
            <td>{{ v.fecha_hora|date:"Y-m-d H:i" }}</td>
            <td>{{ v.vendedor.username }}</td>
            <td class="desc">{{ v.resumen_productos }}</td>
            <td>${{ v.total|floatformat:2 }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p class="empty-state">No hay ventas recientes.</p>
      {% endif %}
    </section>

    <!-- Productos recientes -->
    <section class="block">
      <div class="block-header">
        <h3>Productos recientes</h3>
        <p class="block-subtitle">Ãšltimos productos agregados o actualizados.</p>
      </div>

      {% if productos_recientes %}
      <table class="table">
        <thead>
          <tr>
            <th>Proveedor</th>
            <th>Nombre</th>
            <th>DescripciÃ³n</th>
            <th>Precio</th>
            <th>Stock</th>
            <th>Asignado a</th>
            <th>AcciÃ³n</th>
          </tr>
        </thead>
        <tbody>
          {% for p in productos_recientes %}
          <tr>
            <td>{{ p.proveedor_nombre }}</td>
            <td>{{ p.nombre }}</td>
            <td class="desc">{{ p.descripcion|default:"-" }}</td>
            <td>${{ p.precio|floatformat:2 }}</td>
            <td>{{ p.stock }}</td>
            <td>
              {% if p.asignado_a %}
                <span class="badge ok">{{ p.asignado_a.username }}</span>
              {% else %}
                <span class="badge warn">Sin asignar</span>
              {% endif %}
            </td>
            <td>
              <a href="{% url 'administrador:asignar_producto' p.id %}"
                 class="btn small primary">
                {% if p.asignado_a %}Reasignar{% else %}+ Asignar{% endif %}
              </a>
              {% if p.asignado_a %}
              <form method="post" action="{% url 'administrador:quitar_producto' p.id %}" class="inline-form" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn small danger">Quitar</button>
              </form>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p class="empty-state">No hay productos registrados aÃºn.</p>
      {% endif %}
    </section>

  </div>
</div>

{% endblock %}
